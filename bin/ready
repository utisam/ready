#!/bin/bash -u

declare READY_RESULT=0
declare -r READY_TEMP_DIR=$(mktemp --tmpdir -d ready.XXXXXXXXXX)

# Import functions

declare -r READY_LIB_DIR=${READY_LIB_DIR:-"$(dirname $BASH_SOURCE)/../lib/ready"}

source "$READY_LIB_DIR/logger.sh"
source "$READY_LIB_DIR/output.sh"

source "$READY_LIB_DIR/check_command.sh"

source "$READY_LIB_DIR/check_eval.sh"
source "$READY_LIB_DIR/check_node.sh"
source "$READY_LIB_DIR/check_python.sh"
source "$READY_LIB_DIR/check_ruby.sh"

# Execute READYRC_FILE

declare READYRC_FILE="${PWD}/.readyrc"
if [[ "$#" = "1" ]]; then
    READYRC_FILE="${PWD}/$1"
fi
declare -r READYRC_FILE

if [[ ! -f "$READYRC_FILE" ]]; then
    log_error "File not found: $READYRC_FILE"
    exit 1
fi

log_debug "Execute: $READYRC_FILE"
source "$READYRC_FILE"

# Cleanup

rm -rf "$READY_TEMP_DIR"

exit $READY_RESULT
